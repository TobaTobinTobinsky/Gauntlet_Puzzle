üìò DOCUMENTO DE ARQUITECTURA T√âCNICA (D√≠a 3)
Objetivo: Implementar la l√≥gica del ciclo de juego (Game Loop). Configurar un actor "Portal" que reaccione al grito del personaje y valide el estado de las estatuas para permitir el progreso.
1. LA ESTATUA RECEPTORA (BP_Estatua)
El objeto no act√∫a por cuenta propia; espera la se√±al del h√©roe y verifica si tiene permiso f√≠sico para girar.
1.1 Memoria L√≥gica
Dentro de BP_Estatua, definimos variables para que el portal pueda consultarlas:
Valor_Actual: (Entero). Guarda la posici√≥n l√≥gica (0-7) calculada tras el giro.
BlockingNumber: (Entero / Editable). Representa la cifra que esta estatua debe alcanzar para que el portal la d√© por v√°lida.
PuedeRotar: (Booleano). Se activa/desactiva mediante la esfera de colisi√≥n para filtrar si la estatua debe o no escuchar al h√©roe.
1.2 Escucha Selectiva
Suscripci√≥n: En el BeginPlay, la estatua se conecta al Event Dispatcher PressE del h√©roe.
Filtro: Cuando el h√©roe emite la se√±al, la estatua ejecuta el evento GirarEstatua, pero solo prosigue si la variable PuedeRotar es verdadera.
2. EL CEREBRO DEL PORTAL (BP_Portal)
Este actor es un observador silencioso que supervisa el sal√≥n.
2.1 Configuraci√≥n de Referencias
Para que el portal pueda juzgar, necesita tener acceso directo a las estatuas. Creamos variables de referencia:
Estatua_0, Estatua_1, Estatua_2, Estatua_3: (Tipo: BP_Estatua / Editables).
Uso: En el editor de niveles, seleccionamos el portal y le asignamos qu√© estatua f√≠sica corresponde a cada variable de su memoria.
2.2 Escucha y Disparo (ActivarPortal)
Al igual que las estatuas, el portal tambi√©n es un receptor de la se√±al del h√©roe:
Vinculaci√≥n: En el BeginPlay, el portal localiza al h√©roe y se suscribe a su dispatcher PressE.
Evento: Esto genera el evento personalizado ActivarPortal.
Funcionamiento: Cada vez que el jugador pulsa la "E", el portal se despierta y ejecuta su funci√≥n de control.
3. L√ìGICA DE VALIDACI√ìN (ControlPass)
Procedimiento de escrutinio manual que determina el √©xito del jugador.
Dentro de la funci√≥n ControlPass, el portal realiza una comprobaci√≥n en cadena de todas las estatuas vinculadas:
Lectura Individual: El portal accede a la variable Valor_Actual de la Estatua_0 y la compara con su n√∫mero objetivo.
Validaci√≥n en Cascada: Repite el proceso con la Estatua_1, Estatua_2, etc.
Veredicto (Return Value):
Si TODAS las comparaciones son correctas, la funci√≥n devuelve un booleano Aprobado = True.
Si una sola falla, devuelve False.
4. CONDICI√ìN DE VICTORIA (The Loop)
Ejecuci√≥n de la respuesta del portal ante el evento del h√©roe.
Tras recibir la respuesta de ControlPass, el portal act√∫a en el Event Graph:
Si es True: Ejecuta un Print String con el mensaje "¬°PORTAL ABIERTO!" y activa el cambio visual (en este caso, moviendo o modificando el Plano que oficia de puerta).
Si es False: Lanza un Print String de "SECUENCIA INCORRECTA" (opcional para debug), manteniendo al jugador dentro del ciclo de puzle.
‚úÖ RESUMEN DE FLUJO ACTUAL
Acci√≥n: El H√©roe pulsa E y emite la se√±al PressE.
Reacci√≥n:
La Estatua cercana escucha y gira.
El Portal escucha y audita a todas las estatuas llamando a ControlPass.
Resultado: Si la auditor√≠a del Portal coincide con la clave, el camino se libera.

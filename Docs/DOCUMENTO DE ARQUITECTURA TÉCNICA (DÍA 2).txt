üìò DOCUMENTO DE ARQUITECTURA T√âCNICA (D√≠a 2)
Objetivo: Establecer un sistema de comunicaci√≥n inal√°mbrica entre el personaje y los objetos del entorno para ejecutar rotaciones mec√°nicas de 45¬∞ y procesar datos l√≥gicos de puzle.
1. EMISI√ìN DE SE√ëAL (El Personaje)
El h√©roe act√∫a como un repetidor que anuncia sus acciones al mapa entero.
1.1 Configuraci√≥n de la Tecla "E" (IA_Interact)
Input Action: En la carpeta _Game/Input/Actions, configuramos el asset IA_Interact.
Consumo: Activamos la opci√≥n "Consume Lower Priority Enhanced Input Mappings". El h√©roe captura la tecla para gestionar √©l mismo la distribuci√≥n del mensaje.
1.2 El Canal de Transmisi√≥n (PressE)
Event Dispatcher: Dentro del Blueprint BP_PuzzleHero, creamos un comunicador llamado PressE.
Llamada: En el gr√°fico de eventos, conectamos el pin Started del evento IA_Interact al nodo Call PressE.
Funcionamiento: Al presionar la E, el personaje emite un "grito" digital que todos los objetos suscritos pueden escuchar.
2. FILTRADO Y RECEPCI√ìN (La Estatua)
Los objetos deciden si reaccionan a la se√±al del h√©roe bas√°ndose en su cercan√≠a f√≠sica.
2.1 Conexi√≥n con el H√©roe (Suscripci√≥n)
En el evento BeginPlay de la BP_Estatua, realizamos el enlace:
Buscamos al jugador con Get Player Character y aplicamos un Cast to BP_PuzzleHero.
Del resultado, ejecutamos el nodo Assign PressE.
Esto genera autom√°ticamente el evento GirarEstatua, quedando vinculado permanentemente a las acciones del h√©roe.
2.2 Validaci√≥n de Proximidad (PuedeRotar)
Para que no giren todas las estatuas a la vez, aplicamos un seguro:
Componente: Usamos una Sphere Collision.
L√≥gica:
Al entrar (BeginOverlap): La variable booleana PuedeRotar pasa a True.
Al salir (EndOverlap): La variable PuedeRotar pasa a False.
Interruptor: Al inicio del evento GirarEstatua, un Branch comprueba la variable. Si es falso, el flujo se detiene.
3. MEC√ÅNICA F√çSICA Y L√ìGICA (El Giro)
Transformaci√≥n del objeto y traducci√≥n de su posici√≥n a un valor num√©rico.
3.1 Animaci√≥n de Rotaci√≥n (Timeline)
Cuando el jugador est√° cerca y presiona E, la estatua gira:
Variables: Guardamos la orientaci√≥n actual en RotacionInicial y calculamos el destino sumando 45¬∞ en Z (Yaw) en la variable RotacionObjetivo.
Cronograma: Iniciamos un Timeline de 2.0 segundos desde el pin Play from Start. Esto garantiza que la animaci√≥n siempre empiece desde el principio en cada pulsaci√≥n.
Movimiento Suave: Usamos un nodo Lerp (Rotator) con Shortest Path activado para actualizar la rotaci√≥n del objeto durante la animaci√≥n.
3.2 C√°lculo del D√≠gito (CalcularDigito)
Para que el sistema de claves funcione, la rotaci√≥n se traduce a un n√∫mero del 0 al 7:
Extracci√≥n: Tomamos el valor Yaw de RotacionObjetivo.
Normalizaci√≥n: Pasamos el valor por el nodo Normalize Axis.
Conversi√≥n: Dividimos por 45.0, aplicamos un Round para eliminar decimales y usamos un M√≥dulo (%) 8.
Resultado: El n√∫mero final se guarda en Valor_Actual.
‚úÖ RESUMEN DE FLUJO
El H√©roe pulsa E y llama al Dispatcher PressE.
La Estatua recibe el aviso y verifica si PuedeRotar es verdadero.
Si es correcto, inicia el giro de 2 segundos y actualiza su Valor_Actual interno.
